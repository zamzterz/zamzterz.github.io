(()=>{var mr=Object.create;var $=Object.defineProperty;var _r=Object.getOwnPropertyDescriptor;var yr=Object.getOwnPropertyNames;var Mr=Object.getPrototypeOf,br=Object.prototype.hasOwnProperty;var pr=n=>$(n,"__esModule",{value:!0});var j=(n,a)=>()=>(a||n((a={exports:{}}).exports,a),a.exports);var Fr=(n,a,i,g)=>{if(a&&typeof a=="object"||typeof a=="function")for(let v of yr(a))!br.call(n,v)&&(i||v!=="default")&&$(n,v,{get:()=>a[v],enumerable:!(g=_r(a,v))||g.enumerable});return n},Pr=(n,a)=>Fr(pr($(n!=null?mr(Mr(n)):{},"default",!a&&n&&n.__esModule?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var er=j(U=>{"use strict";var d=U&&U.__assign||function(){return d=Object.assign||function(n){for(var a,i=1,g=arguments.length;i<g;i++){a=arguments[i];for(var v in a)Object.prototype.hasOwnProperty.call(a,v)&&(n[v]=a[v])}return n},d.apply(this,arguments)};Object.defineProperty(U,"__esModule",{value:!0});var Or={threshold:.1,sampleRate:44100,probabilityThreshold:.1};function Sr(n){n===void 0&&(n={});var a=d(d({},Or),n),i=a.threshold,g=a.sampleRate,v=a.probabilityThreshold;return function(F){var r;for(r=1;r<F.length;r*=2);r/=2;for(var o=r/2,l=new Float32Array(o),_=0,f,e=0;e<o;e++)l[e]=0;for(var e=1;e<o;e++)for(var y=0;y<o;y++){var b=F[y]-F[y+e];l[e]+=b*b}l[0]=1,l[1]=1;for(var P=0,e=1;e<o;e++)P+=l[e],l[e]*=e/P;for(f=2;f<o;f++)if(l[f]<i){for(;f+1<o&&l[f+1]<l[f];)f++;_=1-l[f];break}if(f===o||l[f]>=i||_<v)return null;var m,t,s;if(f<1?t=f:t=f-1,f+1<o?s=f+1:s=f,t===f)l[f]<=l[s]?m=f:m=s;else if(s===f)l[f]<=l[t]?m=f:m=t;else{var c=l[t],h=l[f],u=l[s];m=f+(u-c)/(2*(2*h-u-c))}return g/m}}U.YIN=Sr});var ar=j(I=>{"use strict";var x=I&&I.__assign||function(){return x=Object.assign||function(n){for(var a,i=1,g=arguments.length;i<g;i++){a=arguments[i];for(var v in a)Object.prototype.hasOwnProperty.call(a,v)&&(n[v]=a[v])}return n},x.apply(this,arguments)};Object.defineProperty(I,"__esModule",{value:!0});var Lr={sampleRate:44100,minFrequency:82,maxFrequency:1e3,ratio:5,sensitivity:.1};function Rr(n){n===void 0&&(n={});var a=x(x({},Lr),n),i=a.sampleRate,g=a.minFrequency,v=a.maxFrequency,M=a.sensitivity,F=a.ratio,r=[],o=Math.ceil(i/g),l=Math.floor(i/v);return function(f){var e=f.length,y=0,b=1/0,P=-1/0,m,t,s,c,h,u,p,O;for(c=0;c<e;c++)if(l<=c&&c<=o){for(p=0,O=c,y=0,m=[],t=[];p<e-c;y++,O++,p++)m[y]=f[p],t[y]=f[O];var L=m.length;for(s=[],u=0;u<L;u++)s[u]=m[u]-t[u];var w=0;for(u=0;u<L;u++)w+=Math.abs(s[u]);r[c]=w}for(h=l;h<o;h++)r[h]<b&&(b=r[h]),r[h]>P&&(P=r[h]);var E=Math.round(M*(P-b)+b);for(h=l;h<=o&&r[h]>E;h++);var A=l/2;b=r[h];var R=h;for(c=h-1;c<h+A&&c<=o;c++)r[c]<b&&(b=r[c],R=c);return Math.round(r[R]*F)<P?i/R:null}}I.AMDF=Rr});var tr=j(N=>{"use strict";var X=N&&N.__assign||function(){return X=Object.assign||function(n){for(var a,i=1,g=arguments.length;i<g;i++){a=arguments[i];for(var v in a)Object.prototype.hasOwnProperty.call(a,v)&&(n[v]=a[v])}return n},X.apply(this,arguments)};Object.defineProperty(N,"__esModule",{value:!0});var nr={sampleRate:44100};function qr(n){n===void 0&&(n=nr);var a=X(X({},nr),n),i=a.sampleRate;return function(v){var M=v.length,F=0,r,o,l,_;for(r=0;r<M;r++)_=v[r],F+=_*_;if(F=Math.sqrt(F/M),F<.01)return-1;var f=0,e=M-1,y=.2;for(r=0;r<M/2;r++)if(Math.abs(v[r])<y){f=r;break}for(r=1;r<M/2;r++)if(Math.abs(v[M-r])<y){e=M-r;break}var b=v.slice(f,e),P=b.length,m=new Array(P).fill(0);for(r=0;r<P;r++)for(o=0;o<P-r;o++)m[r]=m[r]+b[o]*b[o+r];for(l=0;m[l]>m[l+1];)l++;var t=-1,s=-1;for(r=l;r<P;r++)m[r]>t&&(t=m[r],s=r);var c=s,h=m[c-1],u=m[c],p=m[c+1],O=(h+p-2*u)/2,L=(p-h)/2;return O&&(c=c-L/(2*O)),i/c}}N.ACF2PLUS=qr});var ir=j(k=>{"use strict";var H=k&&k.__assign||function(){return H=Object.assign||function(n){for(var a,i=1,g=arguments.length;i<g;i++){a=arguments[i];for(var v in a)Object.prototype.hasOwnProperty.call(a,v)&&(n[v]=a[v])}return n},H.apply(this,arguments)};Object.defineProperty(k,"__esModule",{value:!0});var Er=6,wr=3e3,Dr=3,jr=.75,Tr={sampleRate:44100};function Ar(n){n===void 0&&(n={});var a=H(H({},Tr),n),i=a.sampleRate;return function(v){for(var M=[],F=[],r=v.length,o=null,l=0,_=0,f=0,e=0;e<r;e++){var y=v[e];l=l+y,f=Math.max(f,y),_=Math.min(_,y)}l/=r,_-=l,f-=l;for(var b=f>-1*_?f:-1*_,P=b*jr,m=0,t=-1,s=v.length,c,h,u;c=~~(i/(Math.pow(2,m)*wr)),!(s<2);){var p=void 0,O=-1e3,L=-1e6,w=-1e6,E=!1,A=!1;u=0,h=0;for(var e=2;e<s;e++){var R=v[e]-l,V=v[e-1]-l;V<=0&&R>0&&(E=!0),V>=0&&R<0&&(A=!0),p=R-V,O>-1e3&&(A&&O<0&&p>=0&&Math.abs(R)>=P&&e>L+c&&(M[u++]=e,L=e,A=!1),E&&O>0&&p<=0&&Math.abs(R)>=P&&e>w+c&&(F[h++]=e,w=e,E=!1)),O=p}if(u===0&&h===0)break;for(var B=void 0,C=[],e=0;e<s;e++)C[e]=0;for(var e=0;e<u;e++)for(var S=1;S<Dr;S++)e+S<u&&(B=Math.abs(M[e]-M[e+S]),C[B]+=1);for(var D=-1,J=-1,e=0;e<s;e++){for(var Y=0,S=-1*c;S<=c;S++)e+S>=0&&e+S<s&&(Y+=C[e+S]);Y===J?e===2*D&&(D=e):Y>J&&(J=Y,D=e)}for(var z=0,rr=0,S=-c;S<=c;S++)if(D+S>=0&&D+S<r){var K=C[D+S];K>0&&(rr+=K,z+=(D+S)*K)}if(z/=rr,t>-1&&Math.abs(z*2-t)<=2*c){o=i/(Math.pow(2,m-1)*t);break}if(t=z,m++,m>=Er||s<2)break;var Z=v.subarray(0);s===C.length&&(Z=new Float32Array(s/2));for(var e=0;e<s/2;e++)Z[e]=(v[2*e]+v[2*e+1])/2;v=Z,s/=2}return o}}k.DynamicWavelet=Ar});var vr=j(W=>{"use strict";var Q=W&&W.__assign||function(){return Q=Object.assign||function(n){for(var a,i=1,g=arguments.length;i<g;i++){a=arguments[i];for(var v in a)Object.prototype.hasOwnProperty.call(a,v)&&(n[v]=a[v])}return n},Q.apply(this,arguments)};Object.defineProperty(W,"__esModule",{value:!0});var Cr={bufferSize:1024,cutoff:.97,sampleRate:44100};function Ur(n){n===void 0&&(n={});var a=Q(Q({},Cr),n),i=a.bufferSize,g=a.cutoff,v=a.sampleRate,M=.5,F=80,r=new Float32Array(i),o=new Float32Array(i),l,_,f=[],e=[],y=[];function b(t){var s,c;o[0]=t[0]*t[0];for(var h=1;h<t.length;h+=1)o[h]=t[h]*t[h]+o[h-1];for(var u=0;u<t.length;u++){s=0,c=o[t.length-1-u]+o[t.length-1]-o[u];for(var h=0;h<t.length-u;h++)s+=t[h]*t[h+u];r[u]=2*s/c}}function P(t){var s=r[t-1],c=r[t],h=r[t+1],u=t,p=h+s-2*c;if(p===0)l=u,_=c;else{var O=s-h;l=u+O/(2*p),_=c-O*O/(8*p)}}function m(){for(var t=0,s=0;t<(r.length-1)/3&&r[t]>0;)t++;for(;t<r.length-1&&r[t]<=0;)t++;for(t==0&&(t=1);t<r.length-1;)if(r[t]>r[t-1]&&r[t]>=r[t+1]&&(s==0||r[t]>r[s])&&(s=t),t++,t<r.length-1&&r[t]<=0)for(s>0&&(f.push(s),s=0);t<r.length-1&&r[t]<=0;)t++;s>0&&f.push(s)}return function(s){var c;f=[],e=[],y=[],b(s),m();for(var h=-1/0,u=0;u<f.length;u++){var p=f[u];h=Math.max(h,r[p]),r[p]>M&&(P(p),y.push(_),e.push(l),h=Math.max(h,_))}if(e.length){for(var O=g*h,L=0,u=0;u<y.length;u++)if(y[u]>=O){L=u;break}var w=e[L],E=v/w;E>F?c=E:c=-1}else c=-1;return{probability:h,freq:c}}}W.Macleod=Ur});var lr=j(T=>{"use strict";var G=T&&T.__assign||function(){return G=Object.assign||function(n){for(var a,i=1,g=arguments.length;i<g;i++){a=arguments[i];for(var v in a)Object.prototype.hasOwnProperty.call(a,v)&&(n[v]=a[v])}return n},G.apply(this,arguments)};Object.defineProperty(T,"__esModule",{value:!0});T.DEFAULT_FREQUENCIES_PARAMS={tempo:120,quantization:4,sampleRate:44100};function Ir(n,a){var i=n.map(function(l){return l(a)}).filter(function(l){return l!==null}).sort(function(l,_){return l-_});if(i.length===1)return i[0];if(i.length===2){var g=i[0],v=i[1];return g*2>v?Math.sqrt(g*v):g}else{var g=i[0],v=i[1],M=i[i.length-2],F=i[i.length-1],r=g*2>v?i:i.slice(1),o=M*2>F?r:r.slice(0,-1);return Math.pow(o.reduce(function(f,e){return f*e},1),1/o.length)}}function Nr(n,a,i){i===void 0&&(i={});var g=G(G({},T.DEFAULT_FREQUENCIES_PARAMS),i),v=g.tempo,M=g.quantization,F=g.sampleRate,r=a.length,o=Math.round(F*60/(M*v)),l;Array.isArray(n)?l=Ir.bind(null,n):l=n;for(var _=[],f=0,e=r-o;f<=e;f+=o){var y=a.slice(f,f+o),b=l(y);_.push(b)}return _}T.frequencies=Nr});var gr=j(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});var fr=er();q.YIN=fr.YIN;var cr=ar();q.AMDF=cr.AMDF;var hr=tr();q.ACF2PLUS=hr.ACF2PLUS;var sr=ir();q.DynamicWavelet=sr.DynamicWavelet;var ur=vr();q.Macleod=ur.Macleod;var or=lr();q.frequencies=or.frequencies;q.default={YIN:fr.YIN,AMDF:cr.AMDF,ACF2PLUS:hr.ACF2PLUS,DynamicWavelet:sr.DynamicWavelet,Macleod:ur.Macleod,frequencies:or.frequencies}});var kr=Pr(gr());self.Pitchfinder=kr;})();
